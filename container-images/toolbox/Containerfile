ARG FEDORA_VERSION=40

FROM registry.fedoraproject.org/fedora-toolbox:${FEDORA_VERSION} AS builder

WORKDIR /build-final

ENV CARGO_HOME=/build/.cargo
RUN dnf install -y cargo
RUN cargo install xh --locked
RUN cp ${CARGO_HOME}/bin/xh /build-final

FROM registry.fedoraproject.org/fedora-toolbox:${FEDORA_VERSION}

ARG NAME=my-fedora-toolbox
LABEL com.github.containers.toolbox="true" \
        name="$NAME" \
        version="$VERSION" \
        usage="This image is meant to be used with the toolbox(1) command" \
        summary="Image for creating Fedora Toolbx containers"

WORKDIR /build-final

COPY ./packages.txt .
RUN dnf --assumeyes update && \
        dnf --assumeyes install $(cat packages.txt) && \
        dnf clean all

RUN wget https://raw.githubusercontent.com/ducaale/xh/master/completions/xh.fish -O /usr/share/fish/completions/xh.fish
RUN rm -r /build-final
